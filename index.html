<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Distance between two markers</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v3.3.1/mapbox.css' rel='stylesheet' />

<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>
<body>

  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.4.10/leaflet.draw.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.4.10/leaflet.draw.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-geodesy/v0.1.0/leaflet-geodesy.js'></script> 

<div id='map'></div>
<div id="distance" class="distance-container"></div>


<script>

L.mapbox.accessToken = 'pk.eyJ1IjoiamFjcXVlczUiLCJhIjoiY2ttMXpwd2pyNDhzbzJ2cW0yN2dsYXFnYyJ9.Df-9CQghAcj27PvWu8TagA';
var map = L.mapbox.map('map')
    .setView([6.346,2.426], 16.50);
    
    L.control.layers({
    'Carte principal': L.mapbox.styleLayer('mapbox://styles/jacques5/ckmuoglzq56jc17pcpixp8ukp').addTo(map),
    'Bollards': L.mapbox.styleLayer('mapbox://styles/jacques5/ckmv68v8j08c217nvqbfh34as'),
    'Quais': L.mapbox.styleLayer('mapbox://styles/jacques5/ckmwew6iu0tmm17ny2i4nb7gq'),
    'Satellite': L.mapbox.styleLayer('mapbox://styles/mapbox/satellite-v9'),

}).addTo(map);



var featureGroup = L.featureGroup().addTo(map);

var drawControl = new L.Control.Draw({
  edit: {
    featureGroup: featureGroup
  },
  draw: {
    polygon: false,
    polyline: true,
    rectangle: false,
    circle: false,
    marker: false
  }
}).addTo(map);

map.on('draw:created', showPolyline);
map.on('draw:edited', showPolyline);

function showPolyline(e) {
  e.layers.eachLayer(function(layer) {
    showPolyline({ layer: layer });
  });
}
function showPolyline(e) {
  featureGroup.clearLayers();
  featureGroup.addLayer(e.layer);
  e.layer.bindPopup((LGeo.line(e.layer)) + ' m');
  e.layer.openPopup();
}


// Ici je récupère les donnée Json via le Web Service
// Je les met dans un tableau comme ci-dessous
var data = [{
 
    lon: 2.429131,
    lat: 6.348622,
    name: 'HSL PORTSMOUTH',
    Tiran: 11.4,
    type_na: "CARGOSH",
    longeur: '207.54',
    color: '#c091e6'
}, {
    lon: 2.428591,
    lat: 6.348596,
    name: 'OFFSHORE EAGLE',
    Tiran: ' <b>T</b>: 1.45m ',
    type_na: "TUG <br>",
    longeur: ' <b>L</b>: 15m <br>',
    color: '#fa946e'
},  {
    lon: 2.423305,
    lat: 6.348247,
    name: 'KAPELLEN',
    Tiran: ' <b>T</b>: 10.41m ',
    type_na: "NOBOAT <br>",
    longeur: ' <b>L</b>: 181.7m <br>',
    color: '#c091e6'
}, {
    lon: 2.422175,
    lat: 6.34815,
    size: '175m',
    name: 'Istanbul',
    color: '#fa946e'
},
{ 
    lon: 2.431302,
    lat: 6.348697,
    name: 'LUCKY SEA',
    Tiran: ' <b>T</b>: 12.69m ',
    type_na: "CARGOSH <br>",
    longeur: ' <b>L</b>: 189.9m <br>',
    color: '#c091e6'
}, {      
    lon: 2.429675,
    lat: 6.348646,
    size: '175m',
    name: 'Istanbul',
    color: '#fa946e'
}];

// Test 2




// Puis je fais une recherche dans le tableau 
// Pour récuperer les coordonnées des bollards Deb et Fin Si ils sont renseigné


L.geoJson({
    type: 'Feature',
    geometry: {
        type: 'LineString',
        coordinates: [[data[0].lon,data[0].lat], [data[1].lon,data[1].lat]]
    },
    properties: {
    description: '1718 14th St NW, Washington, DC, L:177.13',
    "stroke": "#fc4353",
    "stroke-opacity": 1,
    "stroke-width": 12,
    }
  }, { style: L.mapbox.simplestyle.style }).addTo(map) 


// Test 2-1


L.geoJson({
    type: 'Feature',
    geometry: {
        type: 'LineString',
        coordinates: [[data[2].lon,data[2].lat], [data[3].lon,data[3].lat]]
    },
    properties: {
    description: '1718 14th St NW, Washington, DC, L:177.13',
    "stroke": "blue",
    "stroke-opacity": 1,
    "stroke-width": 12,
    }
  }, { style: L.mapbox.simplestyle.style }).addTo(map) 

// Nav 3
  L.geoJson({
    type: 'Feature',
    geometry: {
        type: 'LineString',
        coordinates: [[data[4].lon,data[4].lat], [data[5].lon,data[5].lat]]
    },
    properties: {
    description: '1718 14th St NW, Washington, DC, L:177.13',
    "stroke": "blue",
    "stroke-opacity": 1,
    "stroke-width": 12,
    }
  }, { style: L.mapbox.simplestyle.style }).addTo(map) 




// Puis je fais une recherche dans le tableau 
// Pour récuperer les coordonnées des bollards Deb et Fin Si ils sont renseigné
// Je récupère les coordonnées du bollards Deb à laquelle j'ajoute un Marker
// Puis je récupère les informations ( Nom du navire, distance, longeur, Tiran d'eau )
// Que je passe par parametre 

L.mapbox.featureLayer({
    type: 'Feature',
    geometry: {
        type: 'Point',
        //  coordonnées Lon, Lat
        coordinates: [
        data[1].lon,
        data[1].lat
        ]
    },
    properties: {
        title: [data[1].name],
        description: [[data[1].type_na, data[1].longeur, data[1].Tiran,data[1].size]],
        'marker-size': 'large',
        'marker-color': '#BE9A6B'
    }
}).addTo(map);


// Test 2-3

L.mapbox.featureLayer({
    type: 'Feature',
    geometry: {
        type: 'Point',
        //  coordonnées Lon, Lat
        coordinates: [
        data[3].lon,
        data[3].lat
        ]
    },
    properties: {
        title: [data[2].name],
        description: [[data[2].type_na, data[2].longeur, data[2].Tiran,data[2].size]],
        'marker-size': 'large',
        'marker-color': '#BE9A6B'
    }
}).addTo(map);

// Test 2-4

L.mapbox.featureLayer({
    type: 'Feature',
    geometry: {
        type: 'Point',
        //  coordonnées Lon, Lat
        coordinates: [
        data[4].lon,
        data[4].lat
        ]
    },
    properties: {
        title: [data[4].name],
        description: [[data[4].type_na, data[4].longeur, data[4].Tiran,data[4].size]],
        'marker-size': 'large',
        'marker-color': '#BE9A6B'
    }
}).addTo(map);



</script>

<script>

</script>
</body>
</html>
